name: E2E Tests
on:
    workflow_dispatch:
    workflow_call:
        inputs:
            environment:
                type: string
                required: true

env:
    SECRET_KEY: yEEl2mN5lw-u2YEOW0k-jtc967R_W532mCGVYiZpwwMmcplQTGG2HIU0KbsHModx4Vgs
    PGPORT: 5431
    POSTGRES_DB: blog
    POSTGRES_PASSWORD: securepassword
    POSTGRES_USER: user
    PGHOST: localhost

jobs:

    test:
        timeout-minutes: 60
        runs-on: ubuntu-latest
        environment: ${{ inputs.environment }}
        steps:
            - uses: actions/checkout@master
            - id: setup
              uses: ./.github/actions/install-deps

            - name: Start Django server
              run: |
                DJANGO_ENV=development uv run python manage.py runserver

            - name: Run your tests
              run: |
                  pip install playwright
                  playwright install --with-deps chromium
                  python e2e/test_signup.py

            - uses: actions/upload-artifact@v4
              if: ${{ !cancelled() }}
              with:
                  name: playwright-traces
                  path: test-results/
                  retention-days: 5
